name: ğŸ” Sync LeetCode Latest Code to Profile README

on:
  workflow_dispatch:    # âœ… Enables manual trigger via GitHub UI
  schedule:
    - cron: '0 */6 * * *'   # âœ… Runs every 6 hours (you can change)

jobs:
  sync-latest-code:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout Profile README Repo
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}  # âœ… Use built-in token
          path: profile

      - name: ğŸ“¥ Checkout LeetCode Auto Repo
        uses: actions/checkout@v3
        with:
          repository: omvirgyan/leetcode-auto-sync
          token: ${{ secrets.GITHUB_TOKEN }}
          path: leetcode

      - name: ğŸ› ï¸ Extract and Inject Code
        run: |
          START="<!-- LEETCODE-LAST-SUBMISSION:START -->"
          END="<!-- LEETCODE-LAST-SUBMISSION:END -->"

          # Extract LeetCode code block
          sed -n '/^## âœ… Submitted Code$/,/^```$/{ 
            /^## âœ… Submitted Code$/d
            /^```$/d
            p
          }' leetcode/README.md > code_only.txt

          # Wrap it in ```java block
          {
            echo '```java'
            cat code_only.txt
            echo '```'
          } > wrapped_code.txt

          # Inject wrapped code into README between markers
          awk -v s="$START" -v e="$END" '
            BEGIN { print_block=1 }
            $0 ~ s {
              print
              while ((getline line < "wrapped_code.txt") > 0) print line
              print_block=0
              next
            }
            $0 ~ e { print_block=1 }
            print_block { print }
          ' profile/README.md > profile/README.tmp

          mv profile/README.tmp profile/README.md

      - name: ğŸš€ Commit and Push Changes
        working-directory: profile
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"

          git add README.md
          git commit -m "âœ¨ğŸ” Synced latest LeetCode solution" || echo "No changes to commit"
          git push
